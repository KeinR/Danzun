
function wait(sec)
    coroutine.yield(sec)
end

function spawn(x, y, vx, vy)
    local e = Entity.new(
        function(self, other)
            print ("nice hit!")
        end,
        entConf,
        [[
            x += dt * m * 10 * vx;
            y += dt * m * 10 * vy;
        ]],
        bvars
    );
    e.x = x
    e.y = y
    e.vx = vx
    e.vy = vy
    e.width = 10
    e.height = 10
    e.autoGC = false
    e:regCircle("enemies")

    e:setScript(function(e)
        while true do
            local x = player:getX() - e:getX()
            local y = player:getY() - e:getY()
            local mag = math.sqrt(x^2 + y^2)
            x = x / mag
            y = y / mag
            local b = Entity.new(
                function(self, other)
                    print ("nice hit!")
                end,
                conf,
                [[
                    var v[2] := { vx, vy };
                    p := p + v * 10 * dt;
                ]]
            );
            b.x = e:getX()
            b.y = e:getY()
            b.vx = x
            b.vy = y
            b.width = 10
            b.height = 10
            b.autoGC = false
            b:regCircle("enemyBullets")

            wait(1);
        end
    end);
end

spawn(40, 0, -0.5, 1)
spawn(80, 0, 0.5, 1)

wait(50)

-- spawn()

-- wait(5)

-- spawn()
