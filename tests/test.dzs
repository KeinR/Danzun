
function wait(sec)
    coroutine.yield(sec)
end

function spawn(x, y, vx, vy)
    local e = game:spawnEntityFull(
        function(self, other)
            print ("nice hit!")
        end,
        entConf,
        [[
            x += dt * m * 10 * vx;
            y += dt * m * 10 * vy;
        ]],
        {
            bvars
        },
        {
            vx = vx,
            vy = vy
        },
        x, y,
        10, 10,
        false,
        "enemies", 0
    );
    e:setScript(function(e)
        while true do
            local x = player:getX() - e:getX();
            local y = player:getY() - e:getY();
            local mag = math.sqrt(x^2 + y^2);
            x = x / mag;
            y = y / mag;
            game:spawnEntityFull(
                function(self, other)
                    print ("nice hit!")
                end,
                conf,
                [[
                    var v[2] := { vx, vy };
                    p := p + v * 10 * dt;
                ]],
                {},
                {
                    vx = x,
                    vy = y
                },
                e:getX(), e:getY(),
                10, 10,
                false,
                "enemyBullets", 0
            );
            wait(1);
        end
    end);
end

spawn(40, 0, -0.5, 1)
spawn(80, 0, 0.5, 1)

wait(50)

-- spawn()

-- wait(5)

-- spawn()
